#!/usr/bin/env python3
"""
–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Cloudflare R2 –±–µ–∑ wrangler/npm
–°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∫–µ—Ç–∞ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Cloudflare + –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ .env
"""

import os
import subprocess
import sys
import shutil as _shutil

def print_header(title):
    """–ü–µ—á–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∞"""
    print("=" * 60)
    print(f"  {title}")
    print("=" * 60)
    print()

def print_step(step, description):
    """–ü–µ—á–∞—Ç—å —à–∞–≥–∞"""
    print(f"üîß –®–∞–≥ {step}: {description}")
    print("-" * 60)
    print()

def print_success(message):
    """–ü–µ—á–∞—Ç—å —É—Å–ø–µ—Ö–∞"""
    print(f"‚úÖ {message}")
    print()

def print_error(message):
    """–ü–µ—á–∞—Ç—å –æ—à–∏–±–∫–∏"""
    print(f"‚ùå {message}")
    print()

def print_warning(message):
    """–ü–µ—á–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è"""
    print(f"‚ö†Ô∏è  {message}")
    print()

def check_boto3():
    """–ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ boto3"""
    try:
        import boto3
        print_success("boto3 —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
        return True
    except ImportError:
        print_warning("boto3 –Ω–µ –Ω–∞–π–¥–µ–Ω. –ë—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏...")
        try:
            result = subprocess.run(
                [sys.executable, "-m", "pip", "install", "boto3"],
                capture_output=True,
                text=True
            )
            if result.returncode == 0:
                print_success("boto3 —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
                return True
            else:
                print_error(f"–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ boto3: {result.stderr}")
                return False
        except Exception as e:
            print_error(f"–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ boto3: {e}")
            return False

def create_env_file():
    """–°–æ–∑–¥–∞–µ–º .env —Ñ–∞–π–ª –∏–∑ —à–∞–±–ª–æ–Ω–∞"""
    print_header("–°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞")
    
    if os.path.exists(".env"):
        print_warning(".env —Ñ–∞–π–ª —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
        print("‚ö†Ô∏è  –§–∞–π–ª –ù–ï –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–∞—à–∏—Ö –∫–ª—é—á–µ–π")
        print()
        print("üìù –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π .env.example.r2 –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ")
        print()
        _shutil.copy(".env.example.r2", ".env.example.r2.new")
        print("‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª .env.example.r2.new")
        print("üìù –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –µ–≥–æ –∏ –∑–∞—Ç–µ–º:")
        print("   mv .env.example.r2.new .env")
        print()
        return False
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ .env.example.r2
    if not os.path.exists(".env.example.r2"):
        print_error(".env.example.r2 –Ω–µ –Ω–∞–π–¥–µ–Ω!")
        print("–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.")
        return False
    
    # –°–æ–∑–¥–∞–µ–º .env —Ñ–∞–π–ª –∏–∑ –ø—Ä–∏–º–µ—Ä–∞
    _shutil.copy(".env.example.r2", ".env")
    print_success(".env —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω –∏–∑ .env.example.r2")
    print()
    
    return True

def print_r2_instructions():
    """–ü–µ—á–∞—Ç–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ R2"""
    print_header("–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Cloudflare R2")
    
    instructions = """
üìã –°–í–û–î–ö–ê –î–ï–ô–°–¢–í–ò–ô:

1Ô∏è‚É£  –°–û–ó–î–ê–ù–ò–ï –ë–ê–ö–ï–¢–ê –í CLOUDFLARE R2:
   ----------------------------------------------
   –∞) –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Cloudflare Dashboard:
      https://dash.cloudflare.com/

   –±) –í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç (–∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π)
   
   –≤) –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª "R2" –≤ –ª–µ–≤–æ–º –º–µ–Ω—é
   
   –≥) –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "Create Bucket"
   
   –¥) –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
      - Name: runbot-media
      - Location: (–≤—ã–±–µ—Ä–∏—Ç–µ –±–ª–∏–∂–∞–π—à–∏–π —Ä–µ–≥–∏–æ–Ω)
        ‚Ä¢ Europe - –¥–ª—è –†–æ—Å—Å–∏–∏
        ‚Ä¢ Asia Pacific - –¥–ª—è –ê–∑–∏–∏
        ‚Ä¢ US - –¥–ª—è –°–®–ê
   
   –µ) –ù–∞–∂–º–∏—Ç–µ "Create Bucket"

2Ô∏è‚É£  –ü–û–õ–£–ß–ï–ù–ò–ï API –¢–û–ö–ï–ù–ê:
   ----------------------------------------------
   –∞) –í –±–∞–∫–µ—Ç–µ "runbot-media" –Ω–∞–∂–º–∏—Ç–µ "Manage R2 API Tokens"
   
   –±) –ù–∞–∂–º–∏—Ç–µ "Create API Token"
   
   –≤) –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:
      ‚úÖ Read
      ‚úÖ Write
      ‚ùå (–ù–ï –æ—Ç–º–µ—á–∞–π—Ç–µ) List –∏ Delete –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
   
   –≥) –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ TTL (–≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞):
      –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: 90 –¥–Ω–µ–π –∏–ª–∏ –±–æ–ª–µ–µ
   
   –¥) –ù–∞–∂–º–∏—Ç–µ "Create API Token"
   
   –µ) –°–ö–û–ü–ò–†–£–ô–¢–ï —Ç—Ä–∏ –∑–Ω–∞—á–µ–Ω–∏—è (–ø–æ—è–≤—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!):
      ‚Ä¢ Account ID       (–Ω–∞–ø—Ä–∏–º–µ—Ä: 1234567890abcdef)
      ‚Ä¢ Access Key ID   (–Ω–∞–ø—Ä–∏–º–µ—Ä: abc123def456ghi789)
      ‚Ä¢ Secret Access Key (–Ω–∞–ø—Ä–∏–º–µ—Ä: xyz987uvw654rst321qwe)

3Ô∏è‚É£  –û–ë–ù–û–í–õ–ï–ù–ò–ï .ENV –§–ê–ô–õ–ê:
   ----------------------------------------------
   –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª .env –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ:
   
   nano .env
   # –∏–ª–∏
   vim .env
   # –∏–ª–∏ –ª—é–±–æ–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä
   
   –ò –¥–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ —Ç—Ä–∏ –∑–Ω–∞—á–µ–Ω–∏—è:
   
   CLOUDFLARE_R2_ACCOUNT_ID=–≤–∞—à_account_id_–æ—Ç_—à–∞–≥–∞_2
   CLOUDFLARE_R2_ACCESS_KEY_ID=–≤–∞—à_access_key_id_–æ—Ç_—à–∞–≥–∞_2
   CLOUDFLARE_R2_SECRET_ACCESS_KEY=–≤–∞—à_secret_key_–æ—Ç_—à–∞–≥–∞_2
   CLOUDFLARE_R2_BUCKET=runbot-media
   STORAGE_TYPE=r2

4Ô∏è‚É£  –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–ê–Ø –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨:
   ----------------------------------------------
   ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Account Dashboard –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∫–µ—Ç–∞
   ‚úÖ –°–æ–∑–¥–∞–π—Ç–µ —Ç–æ–∫–µ–Ω —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ (Read + Write)
   ‚úÖ –°—Ä–∞–∑—É –∫–æ–ø–∏—Ä—É–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è - –æ–Ω–∏ –±–æ–ª—å—à–µ –Ω–µ –ø–æ—è–≤—è—Ç—Å—è
   ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ .env —Ñ–∞–π–ª –ø–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   ‚ö†Ô∏è  –ù–µ –¥–µ–ª–∏—Ç–µ—Å—å .env —Ñ–∞–π–ª–æ–º –∏ –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç–µ –µ–≥–æ –≤ Git

5Ô∏è‚É£  –ü–†–û–í–ï–†–ö–ê –†–ê–ë–û–¢–û–°–ü–û–°–û–ë–ù–û–°–¢–ò:
   ----------------------------------------------
   –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–π –≤ .env, –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç:
   
   python3 -c "from src.utils.storage import StorageManager; sm = StorageManager(); print('‚úÖ R2 –Ω–∞—Å—Ç—Ä–æ–µ–Ω' if sm.storage_type == 'r2' else '‚ùå –û—à–∏–±–∫–∞')"

6Ô∏è‚É£  –ú–ò–ì–†–ê–¶–ò–Ø –°–£–©–ï–°–¢–í–£–Æ–©–ò–• –§–ê–ô–õ–û–í:
   ----------------------------------------------
   –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —Ñ–∞–π–ª—ã –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ø–∞–ø–∫–µ runbot/media:
   
   python3 scripts/migrate_media.py migrate
   
   –°–∫—Ä–∏–ø—Ç:
   ‚Ä¢ –ù–∞–π–¥–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã –≤ runbot/media
   ‚Ä¢ –ó–∞–≥—Ä—É–∑–∏—Ç –∏—Ö –≤ Cloudflare R2
   ‚Ä¢ –û–±–Ω–æ–≤–∏—Ç –ø—É—Ç–∏ –≤ –ë–î –Ω–∞ r2://...
   ‚Ä¢ –ü–æ–∫–∞–∂–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –º–∏–≥—Ä–∞—Ü–∏–∏

7Ô∏è‚É£  –î–ï–ü–õ–û–ô –ù–ê RENDER:
   ----------------------------------------------
   git push origin main
   
   Render –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
   ‚Ä¢ –í—ã–ø–æ–ª–Ω–∏—Ç git pull
   ‚Ä¢ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç boto3 (pip install)
   ‚Ä¢ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   ‚Ä¢ –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Cloudflare R2 –¥–ª—è —Ñ–∞–π–ª–æ–≤

‚ÑπÔ∏è  –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø:
   ----------------------------------------------
   ‚Ä¢ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ª–∏–º–∏—Ç R2: 10GB —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ + 10GB —Ç—Ä–∞—Ñ–∏–∫–∞/–º–µ—Å—è—Ü
   ‚Ä¢ –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—Å–∏—Ç–µ –ª–∏–º–∏—Ç: —Ü–µ–Ω–∞ $0.015/GB/–º–µ—Å—è—Ü
   ‚Ä¢ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ —Å–≤–µ—Ä—Ö –ª–∏–º–∏—Ç–∞: ~$0.15 –∑–∞ 10GB
   ‚Ä¢ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –¥–µ–ø–ª–æ—è–º–∏
   ‚Ä¢ CDN –≤–∫–ª—é—á–µ–Ω –±–µ—Å–ø–ª–∞—Ç–Ω–æ
   ‚Ä¢ –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å

üö®  –í–ê–ñ–ù–´–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–Ø:
   ----------------------------------------------
   1. –ù–ï –¥–µ–ª–∏—Ç–µ—Å—å API —Ç–æ–∫–µ–Ω–∞–º–∏
   2. –ù–ï –∫–æ–º–º–∏—Ç–∏—Ç–µ .env —Ñ–∞–π–ª –≤ Git
   3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ API —Ç–æ–∫–µ–Ω—ã –≤ –Ω–∞–¥–µ–∂–Ω–æ–º –º–µ—Å—Ç–µ
   4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ —Ç–æ–∫–µ–Ω–∞ (Read + Write)
   5. –°—Ä–∞–∑—É –∫–æ–ø–∏—Ä—É–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è - –æ–Ω–∏ –∏—Å—á–µ–∑–Ω—É—Ç
"""

    print(instructions)
    print()

def print_summary():
    """–ü–µ—á–∞—Ç–∞–µ–º –∏—Ç–æ–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏"""
    print_header("–°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò")
    
    steps = """
üìù –ö–û–ù–¢–†–û–õ–¨–ù–´–ô –°–ü–ò–°–û–ö:
   ------------------------------
   ‚òê  –°–æ–∑–¥–∞–Ω –±–∞–∫–µ—Ç "runbot-media" –≤ Cloudflare R2
   ‚òê  –°–æ–∑–¥–∞–Ω R2 API —Ç–æ–∫–µ–Ω —Å –ø—Ä–∞–≤–∞–º–∏ Read + Write
   ‚òê  –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã 3 –∑–Ω–∞—á–µ–Ω–∏—è: Account ID, Access Key ID, Secret Key
   ‚òê  –û–±–Ω–æ–≤–ª–µ–Ω .env —Ñ–∞–π–ª —Å 3 –∫–ª—é—á–∞–º–∏
   ‚òê  –ó–∞–ø—É—â–µ–Ω —Ç–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ R2
   ‚òê  –í—ã–ø–æ–ª–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
   ‚òê  –ó–∞–∫–æ–º–º–∏—á–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è (.env –≤ .gitignore)
   ‚òê  –ó–∞–ø—É—à–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ main
   ‚òê  –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –Ω–∞ Render

üí° –°–û–í–ï–¢–´:
   ------------------------------
   ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Account Dashboard –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∫–µ—Ç–∞
   ‚Ä¢ –°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ç–æ–∫–µ–Ω —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
   ‚Ä¢ –°—Ä–∞–∑—É –∫–æ–ø–∏—Ä—É–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è - –æ–Ω–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
   ‚Ä¢ –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω—ã –≤ –º–µ–Ω–µ–¥–∂–µ—Ä–µ –ø–∞—Ä–æ–ª–µ–π
   ‚Ä¢ –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –Ω–∞ Render
   ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ .gitignore –¥–ª—è .env —Ñ–∞–π–ª–∞
"""

    print(steps)
    print()

def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    import argparse
    
    parser = argparse.ArgumentParser(
        description='–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Cloudflare R2 –±–µ–∑ wrangler/npm'
    )
    
    parser.add_argument('--full', action='store_true',
                       help='–ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞: –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ + .env + –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏')
    parser.add_argument('--deps', action='store_true',
                       help='–¢–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∞/—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π')
    parser.add_argument('--env', action='store_true',
                       help='–¢–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞')
    parser.add_argument('--instructions', action='store_true',
                       help='–¢–æ–ª—å–∫–æ –ø–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏')
    
    args = parser.parse_args()
    
    if args.instructions:
        print_r2_instructions()
        print_summary()
        return 0
    
    # –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    print_step(1, "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π")
    if not check_boto3():
        print_error("–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏")
        return 1
    
    # –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞
    if args.deps:
        return 0
    
    print_step(2, "–°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞")
    if not create_env_file():
        return 1
    
    if args.env:
        return 0
    
    # –®–∞–≥ 3: –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
    print_step(3, "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Cloudflare R2")
    print_r2_instructions()
    
    # –ò—Ç–æ–≥–∏
    if args.full:
        print_summary()
    else:
        print()
        print("üìù –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:")
        print("   python3 scripts/setup_r2_manual.py --full")
        print()
        print("üìù –¢–æ–ª—å–∫–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:")
        print("   python3 scripts/setup_r2_manual.py --instructions")
    
    return 0

if __name__ == "__main__":
    sys.exit(main())
