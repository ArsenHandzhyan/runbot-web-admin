{% extends "base.html" %}

{% block title %}–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - RunBot Admin{% endblock %}

{% block scripts %}
<script>
    // Update server time display
    function updateServerTime() {
        const now = new Date();
        const timeString = now.toLocaleDateString('ru-RU') + ' ' + now.toLocaleTimeString('ru-RU');
        document.getElementById('server-time').textContent = timeString;
    }
    
    // Update time immediately and every second
    updateServerTime();
    setInterval(updateServerTime, 1000);
</script>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h1>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h1>
            <p class="text-muted">–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</p>
        </div>
    </div>
    
    <!-- Summary Cards -->
    <div class="row mt-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">–£—á–∞—Å—Ç–Ω–∏–∫–∏</h5>
                            <h2>{{ total_participants }}</h2>
                        </div>
                        <i class="fas fa-users fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">–°–æ–±—ã—Ç–∏—è</h5>
                            <h2>{{ total_events }}</h2>
                        </div>
                        <i class="fas fa-calendar-alt fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">–ß–µ–ª–ª–µ–Ω–¥–∂–∏</h5>
                            <h2>{{ total_challenges }}</h2>
                        </div>
                        <i class="fas fa-trophy fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">–û—Ç—á–µ—Ç—ã</h5>
                            <h2>{{ submissions_by_status.values()|sum }}</h2>
                        </div>
                        <i class="fas fa-file-alt fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Submissions by Status -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">–°—Ç–∞—Ç—É—Å—ã –æ—Ç—á–µ—Ç–æ–≤</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                    <th>–ü—Ä–æ—Ü–µ–Ω—Ç</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% set total_submissions = submissions_by_status.values()|sum %}
                                {% for status, count in submissions_by_status.items() %}
                                <tr>
                                    <td>
                                        {% if status == 'pending' %}
                                            <span class="badge bg-warning">–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</span>
                                        {% elif status == 'approved' %}
                                            <span class="badge bg-success">–û–¥–æ–±—Ä–µ–Ω–æ</span>
                                        {% elif status == 'rejected' %}
                                            <span class="badge bg-danger">–û—Ç–∫–ª–æ–Ω–µ–Ω–æ</span>
                                        {% elif status == 'cancelled' %}
                                            <span class="badge bg-secondary">–û—Ç–º–µ–Ω–µ–Ω–æ</span>
                                        {% else %}
                                            <span class="badge bg-dark">{{ status }}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ count }}</td>
                                    <td>
                                        {% if total_submissions > 0 %}
                                            {{ "%.1f"|format((count / total_submissions * 100)) }}%
                                        {% else %}
                                            0%
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Recent Activity -->
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <a href="{{ url_for('participants') }}" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-users"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="{{ url_for('events') }}" class="btn btn-outline-success btn-sm">
                                <i class="fas fa-calendar-alt"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–±—ã—Ç–∏–π
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="{{ url_for('challenges') }}" class="btn btn-outline-warning btn-sm">
                                <i class="fas fa-trophy"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä —á–µ–ª–ª–µ–Ω–¥–∂–µ–π
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">–°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        <li><strong>–í–µ—Ä—Å–∏—è:</strong> RunBot v1.0</li>
                        <li><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="badge bg-success">–û–Ω–ª–∞–π–Ω</span></li>
                        <li><strong>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:</strong> SQLite</li>
                        <li><strong>–í—Ä–µ–º—è —Å–µ—Ä–≤–µ—Ä–∞:</strong> <span id="server-time"></span></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}