# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è Render —Å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º

## –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è

### 1. Render Disk (–ü—Ä–æ—Å—Ç–æ–π, –Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π)
- **–ë–µ—Å–ø–ª–∞—Ç–Ω–æ**: 1GB –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- **–ü–ª—é—Å—ã**: –†–∞–±–æ—Ç–∞–µ—Ç "–∏–∑ –∫–æ—Ä–æ–±–∫–∏", –Ω–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- **–ú–∏–Ω—É—Å—ã**: –ü—Ä–∏ –ø–µ—Ä–µ—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞—Ç–µ—Ä—Ç—ã, –º–∞–ª–æ –º–µ—Å—Ç–∞

### 2. Cloudflare R2 (–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π, 10GB –±–µ—Å–ø–ª–∞—Ç–Ω–æ)
- **–ë–µ—Å–ø–ª–∞—Ç–Ω–æ**: 10GB —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ + 10GB —Ç—Ä–∞—Ñ–∏–∫–∞ –≤ –º–µ—Å—è—Ü
- **–ü–ª—é—Å—ã**: –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –¥–µ–ø–ª–æ—è–º–∏, –≤—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å, CDN
- **–ú–∏–Ω—É—Å—ã**: –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª—é—á–µ–π –¥–æ—Å—Ç—É–ø–∞

### 3. Backblaze B2 (10GB –±–µ—Å–ø–ª–∞—Ç–Ω–æ + 1GB –≤ –¥–µ–Ω—å –±—ç–∫–∞–ø–æ–≤)
- **–ë–µ—Å–ø–ª–∞—Ç–Ω–æ**: 10GB —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- **–ü–ª—é—Å—ã**: –°–æ–≤–º–µ—Å—Ç–∏–º —Å S3, –Ω–∞–¥—ë–∂–Ω—ã–π
- **–ú–∏–Ω—É—Å—ã**: –ù—É–∂–Ω–æ –æ–ø–ª–∞—á–∏–≤–∞—Ç—å –±—ç–∫–∞–ø—ã —Å–≤–µ—Ä—Ö –ª–∏–º–∏—Ç–∞

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: Cloudflare R2

**–ü–æ—á–µ–º—É R2:**
- 10GB –±–µ—Å–ø–ª–∞—Ç–Ω–æ (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –º–µ–¥–∏–∞ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞)
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ —Å–≤–µ—Ä—Ö –ª–∏–º–∏—Ç–∞ ($0.015/GB/–º–µ—Å—è—Ü)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è CDN –±–µ—Å–ø–ª–∞—Ç–Ω–æ
- –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
- –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –¥–µ–ø–ª–æ—è–º–∏

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ R2 –±–∞–∫–µ—Ç–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å wrangler (CLI Cloudflare)
npm install -g wrangler

# –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è
wrangler login

# –°–æ–∑–¥–∞—Ç—å –±–∞–∫–µ—Ç
wrangler r2 bucket create runbot-media

# –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–∞
wrangler r2 bucket list
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ Render

–î–æ–±–∞–≤–∏—Ç—å –≤ Render Dashboard ‚Üí Environment:

```env
# –•—Ä–∞–Ω–∏–ª–∏—â–µ —Ñ–∞–π–ª–æ–≤
CLOUDFLARE_R2_ACCESS_KEY_ID=–≤–∞—à_access_key_id
CLOUDFLARE_R2_SECRET_ACCESS_KEY=–≤–∞—à_secret_access_key
CLOUDFLARE_R2_BUCKET=runbot-media
CLOUDFLARE_R2_ACCOUNT_ID=–≤–∞—à_account_id

# –ò–ª–∏ –¥–ª—è Render Disk
MEDIA_PATH=/opt/render/project/data/media

# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω)
MAX_UPLOAD_SIZE_MB=10
MAX_FILES_PER_USER=5
MAX_TOTAL_FILES=1000
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å R2

```python
# src/utils/storage.py - –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º
import os
import boto3
from werkzeug.utils import secure_filename
from datetime import datetime, timedelta

class StorageManager:
    """–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Cloudflare R2 –∏ Render Disk"""

    def __init__(self):
        self.storage_type = os.getenv('STORAGE_TYPE', 'render_disk')  # 'r2' –∏–ª–∏ 'render_disk'
        self.max_size_mb = int(os.getenv('MAX_UPLOAD_SIZE_MB', '10'))
        
        if self.storage_type == 'r2':
            # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ R2
            endpoint_url = f"https://{os.getenv('CLOUDFLARE_R2_ACCOUNT_ID')}.r2.cloudflarestorage.com"
            self.s3_client = boto3.client(
                's3',
                endpoint_url=endpoint_url,
                aws_access_key_id=os.getenv('CLOUDFLARE_R2_ACCESS_KEY_ID'),
                aws_secret_access_key=os.getenv('CLOUDFLARE_R2_SECRET_ACCESS_KEY'),
            )
            self.bucket = os.getenv('CLOUDFLARE_R2_BUCKET')
        else:
            # Render Disk
            self.media_path = os.getenv('MEDIA_PATH', './media')
    
    def upload_file(self, file, filename=None):
        """–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª"""
        if filename is None:
            filename = secure_filename(file.filename)
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
        file.seek(0, os.SEEK_END)
        file_size = file.tell() / (1024 * 1024)  # MB
        
        if file_size > self.max_size_mb:
            raise ValueError(f'–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º—É–º: {self.max_size_mb}MB')
        
        file.seek(0)  # –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –Ω–∞—á–∞–ª–æ
        
        if self.storage_type == 'r2':
            # –ó–∞–≥—Ä—É–∑–∫–∞ –≤ R2
            timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
            filename = f"{timestamp}_{filename}"
            
            self.s3_client.upload_fileobj(
                file,
                self.bucket,
                filename,
                ExtraArgs={'ContentType': file.content_type}
            )
            
            return {
                'path': f"r2://{self.bucket}/{filename}",
                'url': f"https://{self.bucket}.r2.cloudflarestorage.com/{filename}",
                'size_mb': file_size
            }
        else:
            # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ (Render Disk)
            os.makedirs(self.media_path, exist_ok=True)
            filepath = os.path.join(self.media_path, filename)
            file.save(filepath)
            
            return {
                'path': filepath,
                'url': f"/media/{filename}",
                'size_mb': file_size
            }
    
    def get_file_url(self, filename):
        """–ü–æ–ª—É—á–∏—Ç—å URL –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è"""
        if self.storage_type == 'r2':
            # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å—Å—ã–ª–∫–∏ (1 —á–∞—Å)
            return self.s3_client.generate_presigned_url(
                self.bucket,
                filename,
                ExpiresIn=3600
            )
        else:
            # –õ–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª
            return f"/media/{filename}"
    
    def delete_file(self, filepath):
        """–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª"""
        if self.storage_type == 'r2':
            # –£–¥–∞–ª–∏—Ç—å –∏–∑ R2
            filename = filepath.split('/')[-1]
            self.s3_client.delete_object(Bucket=self.bucket, Key=filename)
        else:
            # –£–¥–∞–ª–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
            if os.path.exists(filepath):
                os.remove(filepath)

    def cleanup_old_files(self, days=7):
        """–û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã"""
        if self.storage_type == 'r2':
            # –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
            objects = self.s3_client.list_objects_v2(Bucket=self.bucket)
            
            cutoff_date = datetime.now() - timedelta(days=days)
            
            for obj in objects.get('Contents', []):
                obj_date = obj['LastModified']
                if obj_date < cutoff_date:
                    print(f"–£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª: {obj['Key']}")
                    self.s3_client.delete_object(
                        Bucket=self.bucket,
                        Key=obj['Key']
                    )
```

### –®–∞–≥ 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```python
# src/web/app.py - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å StorageManager
from src.utils.storage import StorageManager
from werkzeug.utils import secure_filename

@app.route('/api/upload', methods=['POST'])
@login_required
def upload_file():
    """API –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤"""
    if 'file' not in request.files:
        return jsonify({'error': '–ù–µ—Ç —Ñ–∞–π–ª–∞'}), 400
    
    file = request.files['file']
    if file.filename == '':
        return jsonify({'error': '–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω'}), 400
    
    try:
        storage = StorageManager()
        result = storage.upload_file(file)
        
        return jsonify({
            'success': True,
            'filename': result['path'],
            'url': result['url'],
            'size_mb': result['size_mb']
        })
    except ValueError as e:
        return jsonify({'error': str(e)}), 400
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: {e}")
        return jsonify({'error': '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞'}), 500

@app.route('/media/<path:filename>')
def serve_media(filename):
    """–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –º–µ–¥–∏–∞ —Ñ–∞–π–ª–æ–≤"""
    storage = StorageManager()
    
    if storage.storage_type == 'r2':
        # –î–ª—è R2 - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π URL
        url = storage.get_file_url(filename)
        return redirect(url)
    else:
        # –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ - –æ—Ç–¥–∞—Ç—å —Ñ–∞–π–ª
        media_path = os.path.join(os.path.dirname(os.path.dirname(__file__)), 'media')
        return send_from_directory(media_path, filename)

# –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤
@app.route('/admin/cleanup', methods=['POST'])
@login_required
def cleanup_old_files():
    """–û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã"""
    storage = StorageManager()
    days = int(request.form.get('days', 7))
    
    try:
        storage.cleanup_old_files(days=days)
        flash(f'–£–¥–∞–ª–µ–Ω—ã —Ñ–∞–π–ª—ã —Å—Ç–∞—Ä—à–µ {days} –¥–Ω–µ–π', 'success')
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏: {e}")
        flash(f'–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏: {e}', 'error')
    
    return redirect(url_for('statistics'))
```

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞

### –í .env:
```env
# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
MAX_UPLOAD_SIZE_MB=10
MAX_FILES_PER_USER=5
MAX_TOTAL_FILES=1000
AUTO_CLEANUP_DAYS=7

# –ö–≤–æ—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
MAX_IMAGE_SIZE_MB=5
MAX_VIDEO_SIZE_MB=50
MAX_DOCUMENT_SIZE_MB=10
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:

```python
def validate_file(file, file_type):
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –ø–æ —Ç–∏–ø—É"""
    max_sizes = {
        'image': int(os.getenv('MAX_IMAGE_SIZE_MB', 5)),
        'video': int(os.getenv('MAX_VIDEO_SIZE_MB', 50)),
        'document': int(os.getenv('MAX_DOCUMENT_SIZE_MB', 10))
    }
    
    if file_type not in max_sizes:
        return False, "–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞"
    
    file.seek(0, os.SEEK_END)
    size_mb = file.tell() / (1024 * 1024)
    file.seek(0)
    
    if size_mb > max_sizes[file_type]:
        return False, f"–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º—É–º: {max_sizes[file_type]}MB –¥–ª—è {file_type}"
    
    return True, ""
```

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ requirements.txt

```txt
# –î–æ–±–∞–≤–∏—Ç—å –¥–ª—è Cloudflare R2
boto3>=1.26.0

# –ò–ª–∏ –¥–ª—è Render Disk (—É–∂–µ –µ—Å—Ç—å)
flask>=2.0.0
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Render

### 1. –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í Render Dashboard ‚Üí Web Service ‚Üí Environment:

```env
# –í—ã–±–æ—Ä —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
STORAGE_TYPE=r2  # –∏–ª–∏ render_disk

# Cloudflare R2 (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω R2)
CLOUDFLARE_R2_ACCESS_KEY_ID=–≤–∞—à_id
CLOUDFLARE_R2_SECRET_ACCESS_KEY=–≤–∞—à_secret
CLOUDFLARE_R2_ACCOUNT_ID=–≤–∞—à_account_id
CLOUDFLARE_R2_BUCKET=runbot-media

# Render Disk (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
MEDIA_PATH=/opt/render/project/data/media

# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
MAX_UPLOAD_SIZE_MB=10
MAX_FILES_PER_USER=5
MAX_TOTAL_FILES=1000
AUTO_CLEANUP_DAYS=7
MAX_IMAGE_SIZE_MB=5
MAX_VIDEO_SIZE_MB=50
MAX_DOCUMENT_SIZE_MB=10

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—É–∂–µ –µ—Å—Ç—å)
DATABASE_URL=postgresql://...
```

### 2. –û–±–Ω–æ–≤–∏—Ç—å build command (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```bash
# –î–ª—è R2 –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å boto3
pip install boto3 && python app.py
```

## –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –¥–µ–ø–ª–æ—è

### Render —É–∂–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç –ø—Ä–∏ –ø—É—à–µ –≤ main:
```bash
# –ü—Ä–æ—Å—Ç–æ –ø—É—à–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git push origin main

# Render –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
# 1. –í—ã–ø–æ–ª–Ω—è–µ—Ç git pull
# 2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (pip install)
# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```
 
### –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤

–ü–µ—Ä–µ–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –Ω–æ–≤–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –ø–µ—Ä–µ–Ω–µ—Å–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã –≤ R2:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install boto3

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
python scripts/migrate_media.py migrate

# –°–∫—Ä–∏–ø—Ç:
# 1. –ù–∞–π–¥–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã –≤ runbot/media
# 2. –ó–∞–≥—Ä—É–∑–∏—Ç –∏—Ö –≤ Cloudflare R2
# 3. –û–±–Ω–æ–≤–∏—Ç –ø—É—Ç–∏ –≤ –ë–î –Ω–∞ r2://...
# 4. –ü–æ–∫–∞–∂–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –º–∏–≥—Ä–∞—Ü–∏–∏
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏:**
- ‚úÖ –§–∞–π–ª—ã –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ R2 (10GB –±–µ—Å–ø–ª–∞—Ç–Ω–æ)
- ‚úÖ –ü—É—Ç–∏ –≤ –ë–î –æ–±–Ω–æ–≤—è—Ç—Å—è –Ω–∞ r2://
- ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –º–µ–∂–¥—É –¥–µ–ø–ª–æ—è–º–∏
- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏–∑ R2 (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤)

```bash
python scripts/migrate_media.py restore

# –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –≠—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏—è –¢–û–õ–¨–ö–û –î–õ–Ø –¢–ï–°–¢–û–í!
# –ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ –º–Ω–æ–≥–æ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:

```python
@app.route('/admin/storage-stats')
@login_required
def storage_stats():
    """–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞"""
    storage = StorageManager()
    
    if storage.storage_type == 'r2':
        # –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É R2
        objects = storage.s3_client.list_objects_v2(Bucket=storage.bucket)
        total_size = sum(obj['Size'] for obj in objects.get('Contents', []))
        file_count = len(objects.get('Contents', []))
        
        return render_template('storage_stats.html',
                         total_size_mb=total_size / (1024*1024),
                         file_count=file_count,
                         max_size_mb=10*1024)  # 10GB
    else:
        # –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
        total_size = 0
        file_count = 0
        for root, dirs, files in os.walk(storage.media_path):
            for file in files:
                file_count += 1
                total_size += os.path.getsize(os.path.join(root, file))
        
        return render_template('storage_stats.html',
                         total_size_mb=total_size / (1024*1024),
                         file_count=file_count,
                         max_size_mb=1*1024)  # 1GB –¥–ª—è Render Disk
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ:
STORAGE_TYPE=r2 python app.py

# –ù–∞ Render –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

## –†–µ–∑—é–º–µ

1. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∫–µ—Ç Cloudflare R2 (–±–µ—Å–ø–ª–∞—Ç–Ω–æ 10GB)
2. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ Render
3. –î–æ–±–∞–≤—å—Ç–µ boto3 –≤ requirements.txt
4. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥ —Å StorageManager
5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤
6. –ü—É—à—å—Ç–µ –≤ main - Render –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç
7. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–Ω–µ—Å–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ migration —Å–∫—Ä–∏–ø—Ç

**–ò—Ç–æ–≥:**
- –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ 10GB (R2) –∏–ª–∏ 1GB (Render Disk)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ Git
- –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –¥–µ–ø–ª–æ—è–º–∏
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤
- –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
